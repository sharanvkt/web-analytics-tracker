(function(window){"use strict";const VERSION="1.0.0";const config={endpoint:null,projectId:null,initialized:false};class Analytics{constructor(){this.version=VERSION;this.sessionId=this.getOrCreateSessionId();this.pageLoadTime=Date.now();this.lastActivityTime=this.pageLoadTime;this.isTracking=false}init(endpoint,projectId){if(config.initialized){console.warn("Analytics already initialized");return}config.endpoint=endpoint;config.projectId=projectId;config.initialized=true;this.startTracking()}getOrCreateSessionId(){let sessionId=sessionStorage.getItem("analytics_session_id");if(!sessionId){sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){const r=Math.random()*16|0;const v=c==="x"?r:r&3|8;return v.toString(16)}));sessionStorage.setItem("analytics_session_id",sessionId)}return sessionId}async sendToApi(collection,data){if(!config.initialized){console.error("Analytics not initialized");return}try{const response=await fetch(`${config.endpoint}/databases/analytics_db/collections/${collection}/documents`,{method:"POST",headers:{"Content-Type":"application/json","X-Appwrite-Project":config.projectId},body:JSON.stringify({data:{sessionId:this.sessionId,...data}})});if(!response.ok){throw new Error("Failed to send analytics data")}}catch(error){console.error("Analytics Error:",error)}}startTracking(){if(this.isTracking)return;this.isTracking=true;this.recordPageView();this.setupActivityTracking()}async recordPageView(){await this.sendToApi("page_views",{pageUrl:window.location.pathname,timestamp:(new Date).toISOString()})}setupActivityTracking(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this));window.addEventListener("beforeunload",this.handleBeforeUnload.bind(this))}handleVisibilityChange(){if(document.hidden){this.updateTimeTracking()}else{this.lastActivityTime=Date.now()}}handleBeforeUnload(){this.updateTimeTracking()}async updateTimeTracking(){const duration=Math.floor((Date.now()-this.lastActivityTime)/1e3);if(duration>0){await this.sendToApi("time_tracking",{pageUrl:window.location.pathname,duration:duration,timestamp:(new Date).toISOString()})}this.lastActivityTime=Date.now()}}window.Analytics=window.Analytics||Analytics;window.analyticsTracker=new Analytics})(window);